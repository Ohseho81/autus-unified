<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¯ AUTUS Physics Map - ì‹¤ì œ ë°ì´í„°</title>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(ellipse at center, #0a1628 0%, #000 100%);
      overflow: hidden;
      color: #fff;
    }
    
    #canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    
    /* í—¤ë” */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, transparent 100%);
      padding: 24px 32px;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    
    .header-left h1 {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 20px rgba(0, 255, 136, 0.5);
    }
    
    .header-left .subtitle {
      color: #666;
      font-size: 11px;
      margin-top: 8px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    
    .header-left .location {
      color: #00ccff;
      font-size: 12px;
      margin-top: 6px;
    }
    
    .header-right {
      display: flex;
      gap: 40px;
    }
    
    .stat { text-align: right; }
    .stat-label { color: #555; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; }
    .stat-value { font-size: 24px; font-weight: 700; margin-top: 4px; }
    
    .green { color: #00ff88; text-shadow: 0 0 20px rgba(0, 255, 136, 0.7); }
    .cyan { color: #00ccff; text-shadow: 0 0 20px rgba(0, 204, 255, 0.7); }
    .gold { color: #ffcc00; text-shadow: 0 0 20px rgba(255, 204, 0, 0.7); }
    .purple { color: #9966ff; text-shadow: 0 0 20px rgba(153, 102, 255, 0.7); }
    
    /* ìˆ˜ì‹ íŒ¨ë„ */
    .formula-panel {
      position: absolute;
      top: 140px;
      right: 32px;
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(0, 204, 255, 0.3);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(20px);
      z-index: 100;
      min-width: 240px;
    }
    
    .formula-title {
      color: #555;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }
    
    .formula-main {
      color: #00ccff;
      font-family: 'Courier New', monospace;
      font-size: 28px;
      font-weight: bold;
      text-shadow: 0 0 30px rgba(0, 204, 255, 0.8);
      margin-bottom: 16px;
    }
    
    .formula-desc {
      color: #666;
      font-size: 11px;
      line-height: 1.8;
    }
    
    .formula-desc strong { color: #888; }
    
    /* ë…¸ë“œ ì •ë³´ íŒ¨ë„ */
    .info-panel {
      position: absolute;
      top: 140px;
      left: 32px;
      background: rgba(0, 0, 0, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.3);
      border-radius: 16px;
      padding: 24px;
      backdrop-filter: blur(20px);
      z-index: 100;
      min-width: 300px;
      display: none;
    }
    
    .info-panel.visible { display: block; }
    
    .info-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 16px;
    }
    
    .info-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: 0 0 30px currentColor;
    }
    
    .info-name { font-weight: bold; font-size: 22px; }
    .info-type { color: #888; font-size: 12px; margin-top: 4px; }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 14px;
    }
    
    .info-row-label { color: #666; }
    .info-row-value { font-weight: bold; }
    
    .info-desc {
      margin-top: 16px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      font-size: 13px;
      color: #888;
      line-height: 1.6;
    }
    
    /* ê°€ì¹˜ í…Œì´ë¸” */
    .value-table {
      position: absolute;
      bottom: 120px;
      left: 32px;
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(0, 255, 136, 0.3);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      min-width: 380px;
    }
    
    .value-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .value-table th {
      color: #555;
      font-size: 10px;
      text-transform: uppercase;
      text-align: left;
      padding: 8px 4px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .value-table td {
      padding: 10px 4px;
      font-size: 13px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .value-table .name { font-weight: bold; }
    .value-table .money { text-align: right; }
    
    /* ì¸ì‚¬ì´íŠ¸ íŒ¨ë„ */
    .insight-panel {
      position: absolute;
      bottom: 120px;
      right: 32px;
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 204, 0, 0.3);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      min-width: 280px;
    }
    
    .insight-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
      font-size: 12px;
      color: #888;
      line-height: 1.5;
    }
    
    .insight-item .icon { font-size: 14px; }
    
    /* ì»¨íŠ¸ë¡¤ */
    .controls {
      position: absolute;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      z-index: 100;
    }
    
    .control-btn {
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(0, 204, 255, 0.4);
      border-radius: 25px;
      color: #fff;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .control-btn:hover {
      background: rgba(0, 204, 255, 0.2);
      border-color: #00ccff;
      transform: translateY(-2px);
    }
    
    .control-btn.active {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
    }
    
    /* í‘¸í„° */
    .footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(0deg, rgba(0, 0, 0, 0.9) 0%, transparent 100%);
      padding: 20px 32px;
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      color: #444;
      z-index: 50;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  
  <!-- í—¤ë” -->
  <div class="header">
    <div class="header-left">
      <h1>ğŸ¯ AUTUS Physics Map</h1>
      <div class="subtitle">ì‹¤ì œ ë°ì´í„° â€¢ ëª¨ë“  ê°œì²´ëŠ” ì‚¬ëŒ â€¢ í”¼ì‹œìŠ¤ í•´ë‹µì€ ëˆ</div>
      <div class="location">ğŸ“ ì„œìš¸ ì„±ë™êµ¬ ì˜¥ìˆ˜ë™ ì–´ìš¸ë¦¼ë”ë¦¬ë²„</div>
    </div>
    <div class="header-right">
      <div class="stat">
        <div class="stat-label">Total Value</div>
        <div class="stat-value green">â‚©1.14ì–µ</div>
      </div>
      <div class="stat">
        <div class="stat-label">Direct Money</div>
        <div class="stat-value cyan">â‚©9,900ë§Œ</div>
      </div>
      <div class="stat">
        <div class="stat-label">Synergy</div>
        <div class="stat-value purple">â‚©3,200ë§Œ</div>
      </div>
      <div class="stat">
        <div class="stat-label">Time Cost</div>
        <div class="stat-value" style="color: #ff6666;">-â‚©1,700ë§Œ</div>
      </div>
    </div>
  </div>
  
  <!-- ìˆ˜ì‹ íŒ¨ë„ -->
  <div class="formula-panel">
    <div class="formula-title">Physics Formula</div>
    <div class="formula-main">V = D - T + S</div>
    <div class="formula-desc">
      <strong>D</strong>: ì§ì ‘ ëˆ (ì›” ìˆ˜ì…)<br>
      <strong>T</strong>: ì‹œê°„ ë¹„ìš© = ì‹œê°„ Ã— ì‹œê¸‰<br>
      <strong>S</strong>: ì‹œë„ˆì§€ = í˜‘ì—… ê°€ì¹˜<br>
      <strong>ì‹œê¸‰</strong>: â‚©10ë§Œì› ê°€ì •
    </div>
  </div>
  
  <!-- ë…¸ë“œ ì •ë³´ íŒ¨ë„ -->
  <div class="info-panel" id="info-panel">
    <div class="info-header">
      <div class="info-icon" id="info-icon">ğŸ‘‘</div>
      <div>
        <div class="info-name" id="info-name">ì˜¤ì„¸í˜¸</div>
        <div class="info-type" id="info-type">SOVEREIGN â€¢ ëŒ€í‘œ</div>
      </div>
    </div>
    <div class="info-row">
      <span class="info-row-label">ì§ì ‘ ëˆ (D)</span>
      <span class="info-row-value cyan" id="info-direct">â‚©5,000ë§Œ</span>
    </div>
    <div class="info-row">
      <span class="info-row-label">ì‹œê°„ ë¹„ìš© (T)</span>
      <span class="info-row-value" style="color: #ff6666" id="info-time">-â‚©500ë§Œ</span>
    </div>
    <div class="info-row">
      <span class="info-row-label">ì‹œë„ˆì§€ (S)</span>
      <span class="info-row-value purple" id="info-synergy">+â‚©800ë§Œ</span>
    </div>
    <div class="info-row" style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px; margin-top: 8px;">
      <span class="info-row-label">ì¢…í•© ê°€ì¹˜ (V)</span>
      <span class="info-row-value green" id="info-value">â‚©5,300ë§Œ</span>
    </div>
    <div class="info-desc" id="info-desc">
      ì¤‘ì•™ í•µì‹¬ - ì „ì²´ ì´ê´„
    </div>
  </div>
  
  <!-- ê°€ì¹˜ í…Œì´ë¸” -->
  <div class="value-table">
    <div class="formula-title" style="margin-bottom: 14px;">ì›”ê°„ ê°€ì¹˜ ìš”ì•½ (â‚©ë§Œì›)</div>
    <table>
      <thead>
        <tr>
          <th>ì‚¬ëŒ</th>
          <th>ì§ì ‘ ëˆ</th>
          <th>ì‹œê°„</th>
          <th>ì‹œë„ˆì§€</th>
          <th>ì¢…í•©</th>
          <th>íŒë‹¨</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="name" style="color: #00ff88;">ğŸ‘‘ ì˜¤ì„¸í˜¸</td>
          <td class="money cyan">+5,000</td>
          <td class="money" style="color: #ff6666;">-500</td>
          <td class="money purple">+800</td>
          <td class="money green" style="font-weight: bold;">5,300</td>
          <td style="color: #00ff88;">ì¤‘ì•™ í•µì‹¬</td>
        </tr>
        <tr>
          <td class="name" style="color: #00ccff;">ğŸ‘¤ ê¹€ê²½í¬</td>
          <td class="money cyan">+2,000</td>
          <td class="money" style="color: #ff6666;">-300</td>
          <td class="money purple">+600</td>
          <td class="money green" style="font-weight: bold;">2,300</td>
          <td style="color: #ffcc00;">ìë™í™” ëŒ€ìƒ</td>
        </tr>
        <tr>
          <td class="name" style="color: #00ccff;">ğŸ‘¤ ì˜¤ì„ ìš°</td>
          <td class="money cyan">+1,500</td>
          <td class="money" style="color: #ff6666;">-400</td>
          <td class="money purple">+1,000</td>
          <td class="money green" style="font-weight: bold;">2,100</td>
          <td style="color: #00ccff;">ì‹œë„ˆì§€ ì¤‘ì‹¬</td>
        </tr>
        <tr>
          <td class="name" style="color: #ffcc00;">ğŸ‘¤ ì˜¤ì—°ìš°</td>
          <td class="money cyan">+800</td>
          <td class="money" style="color: #ff6666;">-300</td>
          <td class="money purple">+500</td>
          <td class="money green" style="font-weight: bold;">1,000</td>
          <td style="color: #ffcc00;">ìë™í™” ëŒ€ìƒ</td>
        </tr>
        <tr>
          <td class="name" style="color: #9966ff;">ğŸ‘¤ ì˜¤ì€ìš°</td>
          <td class="money cyan">+600</td>
          <td class="money" style="color: #ff6666;">-200</td>
          <td class="money purple">+300</td>
          <td class="money green" style="font-weight: bold;">700</td>
          <td style="color: #9966ff;">ë³´ì¡´ ëŒ€ìƒ</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- ì¸ì‚¬ì´íŠ¸ íŒ¨ë„ -->
  <div class="insight-panel">
    <div class="formula-title" style="margin-bottom: 14px; color: #ffcc00;">ğŸ’¡ ì¸ì‚¬ì´íŠ¸</div>
    <div class="insight-item">
      <span class="icon">ğŸ‘‘</span>
      <span><strong style="color: #00ff88;">ì˜¤ì„¸í˜¸</strong>ê°€ ì¤‘ì•™ í•µì‹¬ (ê°€ì¥ í° ê°€ì¹˜)</span>
    </div>
    <div class="insight-item">
      <span class="icon">ğŸ¤</span>
      <span><strong style="color: #00ccff;">ì˜¤ì„ ìš°</strong> ì‹œë„ˆì§€ ë†’ìŒ (í˜‘ì—… ê°•í™” ê¶Œì¥)</span>
    </div>
    <div class="insight-item">
      <span class="icon">ğŸ¤–</span>
      <span><strong style="color: #ffcc00;">ê¹€ê²½í¬/ì˜¤ì—°ìš°</strong> ìë™í™” í›„ë³´</span>
    </div>
    <div class="insight-item">
      <span class="icon">ğŸ›¡ï¸</span>
      <span><strong style="color: #9966ff;">ì˜¤ì€ìš°</strong> ë³´ì¡´ ëŒ€ìƒ (ì•ˆì •ì  ì—­í• )</span>
    </div>
    <div class="insight-item">
      <span class="icon">â­</span>
      <span><strong style="color: #ffcc00;">ì˜ˆì¸¡</strong>: ì˜¤ì„¸í˜¸â†’ì˜¤ì€ìš° ì‹œë„ˆì§€ ì¦ê°€ ê¸°ëŒ€</span>
    </div>
  </div>
  
  <!-- ì»¨íŠ¸ë¡¤ -->
  <div class="controls">
    <button class="control-btn" id="btn-center">ğŸ  ì¤‘ì‹¬</button>
    <button class="control-btn active" id="btn-animate">âœ¨ ë³„ë˜¥ë³„</button>
    <button class="control-btn" id="btn-labels">ğŸ·ï¸ ë¼ë²¨</button>
    <button class="control-btn" id="btn-values">ğŸ’° ê°€ì¹˜</button>
  </div>
  
  <!-- í‘¸í„° -->
  <div class="footer">
    <span>ğŸ–±ï¸ ë“œë˜ê·¸: ì´ë™ | ìŠ¤í¬ë¡¤: ì¤Œ | ë…¸ë“œ í´ë¦­: ìƒì„¸ ì •ë³´</span>
    <span>AUTUS Physics Map â€¢ ì‹¤ì œ ë°ì´í„° â€¢ V = D - T + S</span>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì‹¤ì œ ë°ì´í„°: ì˜¥ìˆ˜ë™ ì–´ìš¸ë¦¼ë”ë¦¬ë²„ + 5ëª…
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const CENTER = { lat: 37.5415, lon: 127.0155, name: 'ì˜¥ìˆ˜ë™ ì–´ìš¸ë¦¼ë”ë¦¬ë²„' };
    
    const nodes = [
      {
        id: 'P01', name: 'ì˜¤ì„¸í˜¸', label: 'ëŒ€í‘œ', role: 'SOVEREIGN',
        lat: 37.5415, lon: 127.0155,
        directMoney: 50000000, timeHours: 50, hourlyValue: 100000, synergy: 8000000,
        status: 'optimal', icon: 'ğŸ‘‘', color: '#00ff88',
        description: 'ì¤‘ì•™ í•µì‹¬ - ì „ì²´ ì´ê´„'
      },
      {
        id: 'P02', name: 'ê¹€ê²½í¬', label: 'ìš´ì˜', role: 'OPERATOR',
        lat: 37.5425, lon: 127.0175,
        directMoney: 20000000, timeHours: 30, hourlyValue: 100000, synergy: 6000000,
        status: 'optimal', icon: 'ğŸ‘¤', color: '#00ccff',
        description: 'ìë™í™” ëŒ€ìƒ - ìš´ì˜ ì—­í• '
      },
      {
        id: 'P03', name: 'ì˜¤ì„ ìš°', label: 'ì½”ì¹­', role: 'EXECUTOR',
        lat: 37.5400, lon: 127.0135,
        directMoney: 15000000, timeHours: 40, hourlyValue: 100000, synergy: 10000000,
        status: 'optimal', icon: 'ğŸ‘¤', color: '#00ccff',
        description: 'ì‹œë„ˆì§€ ì¤‘ì‹¬ - ì½”ì¹­ ì—­í• '
      },
      {
        id: 'P04', name: 'ì˜¤ì—°ìš°', label: 'ì½”ì¹­', role: 'EXECUTOR',
        lat: 37.5435, lon: 127.0145,
        directMoney: 8000000, timeHours: 30, hourlyValue: 100000, synergy: 5000000,
        status: 'optimal', icon: 'ğŸ‘¤', color: '#ffcc00',
        description: 'ìë™í™” ëŒ€ìƒ - ì½”ì¹­ ì—­í• '
      },
      {
        id: 'P05', name: 'ì˜¤ì€ìš°', label: 'ì§€ì›', role: 'SUPPORT',
        lat: 37.5405, lon: 127.0185,
        directMoney: 6000000, timeHours: 20, hourlyValue: 100000, synergy: 3000000,
        status: 'optimal', icon: 'ğŸ‘¤', color: '#9966ff',
        description: 'ë³´ì¡´ ëŒ€ìƒ - ì§€ì› ì—­í• '
      }
    ];
    
    // ê°€ì¹˜ ê³„ì‚°
    nodes.forEach(n => {
      n.timeCost = n.timeHours * n.hourlyValue;
      n.value = n.directMoney - n.timeCost + n.synergy;
    });
    
    const flows = [
      { from: 'P01', to: 'P02', value: 15000000, type: 'inflow' },
      { from: 'P02', to: 'P03', value: 10000000, type: 'inflow' },
      { from: 'P03', to: 'P04', value: 8000000, type: 'inflow' },
      { from: 'P04', to: 'P05', value: 5000000, type: 'inflow' },
      { from: 'P01', to: 'P03', value: 10000000, type: 'synergy' },
      { from: 'P02', to: 'P04', value: 6000000, type: 'synergy' },
      { from: 'P01', to: 'P05', value: 20000000, type: 'prediction' }
    ];
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    let offsetX = 0, offsetY = 0;
    let scale = 1;
    let isDragging = false;
    let dragStart = { x: 0, y: 0 };
    let isAnimating = true;
    let showLabels = true;
    let showValues = true;
    let particles = [];
    let screenNodes = [];
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
      
      // ì´ˆê¸° ì¤Œ/ì˜¤í”„ì…‹ (ì˜¥ìˆ˜ë™ ì¤‘ì‹¬)
      scale = 8000;
      offsetX = 0;
      offsetY = 0;
      
      updateScreenPositions();
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì¢Œí‘œ ë³€í™˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function lonLatToScreen(lon, lat) {
      const x = width / 2 + (lon - CENTER.lon) * scale + offsetX;
      const y = height / 2 - (lat - CENTER.lat) * scale + offsetY;
      return { x, y };
    }
    
    function updateScreenPositions() {
      screenNodes = nodes.map(node => {
        const pos = lonLatToScreen(node.lon, node.lat);
        return { ...node, x: pos.x, y: pos.y };
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // íŒŒí‹°í´ ì‹œìŠ¤í…œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function initParticles() {
      particles = [];
      flows.forEach(flow => {
        const count = flow.type === 'prediction' ? 8 : 5;
        for (let i = 0; i < count; i++) {
          particles.push({
            flowFrom: flow.from,
            flowTo: flow.to,
            flowType: flow.type,
            flowValue: flow.value,
            progress: Math.random(),
            speed: 0.003 + Math.random() * 0.004,
            size: flow.type === 'prediction' ? 5 : 4,
            trail: []
          });
        }
      });
    }
    
    function updateParticles() {
      particles.forEach(p => {
        p.progress += p.speed;
        if (p.progress > 1) {
          p.progress = 0;
          p.trail = [];
        }
        
        const fromNode = screenNodes.find(n => n.id === p.flowFrom);
        const toNode = screenNodes.find(n => n.id === p.flowTo);
        if (!fromNode || !toNode) return;
        
        const midX = (fromNode.x + toNode.x) / 2;
        const midY = (fromNode.y + toNode.y) / 2 - 40;
        
        const t = p.progress;
        p.x = Math.pow(1-t, 2) * fromNode.x + 2 * (1-t) * t * midX + Math.pow(t, 2) * toNode.x;
        p.y = Math.pow(1-t, 2) * fromNode.y + 2 * (1-t) * t * midY + Math.pow(t, 2) * toNode.y;
        
        p.trail.push({ x: p.x, y: p.y });
        if (p.trail.length > 20) p.trail.shift();
      });
    }
    
    initParticles();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë Œë”ë§
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function render() {
      ctx.fillStyle = 'rgba(10, 22, 40, 0.2)';
      ctx.fillRect(0, 0, width, height);
      
      // ë°°ê²½ ê·¸ë¦¬ë“œ
      renderGrid();
      
      // ì¤‘ì‹¬ì  í‘œì‹œ
      renderCenter();
      
      // ëˆ íë¦„
      renderFlows();
      
      // íŒŒí‹°í´
      if (isAnimating) renderParticles();
      
      // ë…¸ë“œ
      renderNodes();
    }
    
    function renderGrid() {
      ctx.strokeStyle = 'rgba(0, 204, 255, 0.05)';
      ctx.lineWidth = 1;
      
      const gridSize = 50;
      for (let x = 0; x < width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, height);
        ctx.stroke();
      }
      for (let y = 0; y < height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(width, y);
        ctx.stroke();
      }
    }
    
    function renderCenter() {
      const center = lonLatToScreen(CENTER.lon, CENTER.lat);
      
      // ì¤‘ì‹¬ ì‹­ìì„ 
      ctx.strokeStyle = 'rgba(0, 255, 136, 0.2)';
      ctx.lineWidth = 1;
      ctx.setLineDash([5, 5]);
      
      ctx.beginPath();
      ctx.moveTo(center.x - 100, center.y);
      ctx.lineTo(center.x + 100, center.y);
      ctx.stroke();
      
      ctx.beginPath();
      ctx.moveTo(center.x, center.y - 100);
      ctx.lineTo(center.x, center.y + 100);
      ctx.stroke();
      
      ctx.setLineDash([]);
    }
    
    function renderFlows() {
      flows.forEach(flow => {
        const fromNode = screenNodes.find(n => n.id === flow.from);
        const toNode = screenNodes.find(n => n.id === flow.to);
        if (!fromNode || !toNode) return;
        
        const midX = (fromNode.x + toNode.x) / 2;
        const midY = (fromNode.y + toNode.y) / 2 - 40;
        
        const gradient = ctx.createLinearGradient(fromNode.x, fromNode.y, toNode.x, toNode.y);
        
        if (flow.type === 'inflow') {
          gradient.addColorStop(0, 'rgba(0, 255, 136, 0.6)');
          gradient.addColorStop(1, 'rgba(0, 204, 255, 0.6)');
        } else if (flow.type === 'synergy') {
          gradient.addColorStop(0, 'rgba(153, 102, 255, 0.5)');
          gradient.addColorStop(1, 'rgba(0, 204, 255, 0.5)');
        } else if (flow.type === 'prediction') {
          gradient.addColorStop(0, 'rgba(255, 204, 0, 0.5)');
          gradient.addColorStop(1, 'rgba(255, 102, 0, 0.5)');
        }
        
        const flowWidth = Math.max(2, Math.sqrt(flow.value) / 1500);
        
        ctx.beginPath();
        ctx.moveTo(fromNode.x, fromNode.y);
        ctx.quadraticCurveTo(midX, midY, toNode.x, toNode.y);
        ctx.strokeStyle = gradient;
        ctx.lineWidth = flowWidth;
        
        if (flow.type === 'prediction') {
          ctx.setLineDash([8, 8]);
        } else {
          ctx.setLineDash([]);
        }
        
        ctx.stroke();
        ctx.setLineDash([]);
      });
    }
    
    function renderParticles() {
      particles.forEach(p => {
        if (!p.x || !p.y) return;
        
        let color;
        if (p.flowType === 'inflow') color = '#00ff88';
        else if (p.flowType === 'synergy') color = '#9966ff';
        else if (p.flowType === 'prediction') color = '#ffcc00';
        
        // íŠ¸ë ˆì¼
        if (p.trail.length > 1) {
          ctx.beginPath();
          ctx.moveTo(p.trail[0].x, p.trail[0].y);
          for (let i = 1; i < p.trail.length; i++) {
            ctx.lineTo(p.trail[i].x, p.trail[i].y);
          }
          const trailGradient = ctx.createLinearGradient(p.trail[0].x, p.trail[0].y, p.x, p.y);
          trailGradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
          trailGradient.addColorStop(1, color);
          ctx.strokeStyle = trailGradient;
          ctx.lineWidth = 2;
          ctx.stroke();
        }
        
        // íŒŒí‹°í´
        const opacity = 0.5 + 0.5 * Math.sin(p.progress * Math.PI);
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.shadowColor = color;
        ctx.shadowBlur = 15;
        ctx.globalAlpha = opacity;
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.shadowBlur = 0;
      });
    }
    
    function renderNodes() {
      screenNodes.forEach(node => {
        const size = Math.max(25, Math.sqrt(node.value) / 800);
        
        // ê¸€ë¡œìš°
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fillStyle = node.color + '15';
        ctx.fill();
        
        // ë©”ì¸ ë…¸ë“œ
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = node.color;
        ctx.shadowColor = node.color;
        ctx.shadowBlur = 20;
        ctx.fill();
        ctx.shadowBlur = 0;
        
        // í…Œë‘ë¦¬
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        // ì•„ì´ì½˜
        ctx.font = `${size}px sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#fff';
        ctx.fillText(node.icon, node.x, node.y);
        
        // ë¼ë²¨
        if (showLabels) {
          ctx.font = 'bold 14px sans-serif';
          ctx.fillStyle = '#fff';
          ctx.fillText(node.name, node.x, node.y + size + 20);
          
          ctx.font = '11px sans-serif';
          ctx.fillStyle = '#888';
          ctx.fillText(node.label, node.x, node.y + size + 36);
        }
        
        // ê°€ì¹˜
        if (showValues) {
          ctx.font = 'bold 12px sans-serif';
          ctx.fillStyle = '#00ff88';
          ctx.fillText(formatMoney(node.value), node.x, node.y - size - 12);
        }
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function animate() {
      updateParticles();
      render();
      requestAnimationFrame(animate);
    }
    
    animate();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì´ë²¤íŠ¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    canvas.addEventListener('mousedown', e => {
      isDragging = true;
      dragStart = { x: e.clientX - offsetX, y: e.clientY - offsetY };
    });
    
    canvas.addEventListener('mousemove', e => {
      if (isDragging) {
        offsetX = e.clientX - dragStart.x;
        offsetY = e.clientY - dragStart.y;
        updateScreenPositions();
      }
    });
    
    canvas.addEventListener('mouseup', () => isDragging = false);
    canvas.addEventListener('mouseleave', () => isDragging = false);
    
    canvas.addEventListener('wheel', e => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? 0.9 : 1.1;
      scale = Math.max(1000, Math.min(50000, scale * delta));
      updateScreenPositions();
      initParticles();
    });
    
    canvas.addEventListener('click', e => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      let clicked = null;
      let minDist = Infinity;
      
      screenNodes.forEach(node => {
        const dist = Math.sqrt(Math.pow(node.x - x, 2) + Math.pow(node.y - y, 2));
        const size = Math.max(25, Math.sqrt(node.value) / 800) * 2;
        if (dist < size && dist < minDist) {
          minDist = dist;
          clicked = node;
        }
      });
      
      if (clicked) showNodeInfo(clicked);
      else document.getElementById('info-panel').classList.remove('visible');
    });
    
    function showNodeInfo(node) {
      const panel = document.getElementById('info-panel');
      panel.classList.add('visible');
      
      document.getElementById('info-icon').textContent = node.icon;
      document.getElementById('info-icon').style.background = node.color;
      document.getElementById('info-name').textContent = node.name;
      document.getElementById('info-type').textContent = `${node.role} â€¢ ${node.label}`;
      document.getElementById('info-direct').textContent = formatMoney(node.directMoney);
      document.getElementById('info-time').textContent = '-' + formatMoney(node.timeCost);
      document.getElementById('info-synergy').textContent = '+' + formatMoney(node.synergy);
      document.getElementById('info-value').textContent = formatMoney(node.value);
      document.getElementById('info-desc').textContent = node.description;
    }
    
    // ì»¨íŠ¸ë¡¤ ë²„íŠ¼
    document.getElementById('btn-center').addEventListener('click', () => {
      scale = 8000;
      offsetX = 0;
      offsetY = 0;
      updateScreenPositions();
      initParticles();
    });
    
    document.getElementById('btn-animate').addEventListener('click', function() {
      isAnimating = !isAnimating;
      this.classList.toggle('active', isAnimating);
      this.textContent = isAnimating ? 'âœ¨ ë³„ë˜¥ë³„' : 'âœ¨ ì •ì§€';
    });
    
    document.getElementById('btn-labels').addEventListener('click', function() {
      showLabels = !showLabels;
      this.classList.toggle('active', showLabels);
    });
    
    document.getElementById('btn-values').addEventListener('click', function() {
      showValues = !showValues;
      this.classList.toggle('active', showValues);
    });
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ìœ í‹¸ë¦¬í‹°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value) {
      if (Math.abs(value) >= 100000000) return 'â‚©' + (value / 100000000).toFixed(2) + 'ì–µ';
      if (Math.abs(value) >= 10000) return 'â‚©' + Math.round(value / 10000).toLocaleString() + 'ë§Œ';
      return 'â‚©' + value.toLocaleString();
    }
    
    console.log('ğŸ¯ AUTUS Physics Map - ì‹¤ì œ ë°ì´í„° initialized');
    console.log('ğŸ“ ìœ„ì¹˜:', CENTER.name);
    console.log('ğŸ‘¥ ì‚¬ëŒ:', nodes.map(n => n.name).join(', '));
  </script>
</body>
</html>
