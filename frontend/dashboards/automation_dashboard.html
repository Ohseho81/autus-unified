<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS Automation Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo span {
            font-size: 12px;
            color: #888;
        }
        
        .status-badge {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Stat Cards */
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.2);
        }
        
        .stat-card .label {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .stat-card .change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .stat-card .change.positive { color: #00ff88; }
        .stat-card .change.negative { color: #ff4757; }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        /* Panel */
        .panel {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Automation List */
        .automation-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .automation-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 16px;
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            align-items: center;
            gap: 16px;
            transition: all 0.2s ease;
        }
        
        .automation-item:hover {
            background: rgba(255,255,255,0.06);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .automation-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .automation-icon.healthy { background: rgba(0,255,136,0.2); }
        .automation-icon.warning { background: rgba(255,193,7,0.2); }
        .automation-icon.danger { background: rgba(255,71,87,0.2); }
        
        .automation-info h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .automation-info span {
            font-size: 12px;
            color: #888;
        }
        
        .automation-value {
            text-align: right;
        }
        
        .automation-value .amount {
            font-size: 16px;
            font-weight: 600;
        }
        
        .automation-value .rate {
            font-size: 12px;
            color: #00ff88;
        }
        
        .automation-synergy {
            width: 60px;
        }
        
        .synergy-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .synergy-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .automation-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover {
            background: rgba(102, 126, 234, 0.3);
        }
        
        .action-btn.feedback:hover { background: rgba(0,255,136,0.3); }
        .action-btn.delete:hover { background: rgba(255,71,87,0.3); }
        
        /* Feedback Panel */
        .feedback-panel {
            position: sticky;
            top: 20px;
        }
        
        .feedback-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .feedback-target {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 16px;
        }
        
        .feedback-target .label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }
        
        .feedback-target .name {
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Yes/No Buttons */
        .rating-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .rating-btn {
            padding: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .rating-btn .icon {
            font-size: 32px;
        }
        
        .rating-btn.yes:hover,
        .rating-btn.yes.selected {
            border-color: #00ff88;
            background: rgba(0,255,136,0.1);
        }
        
        .rating-btn.no:hover,
        .rating-btn.no.selected {
            border-color: #ff4757;
            background: rgba(255,71,87,0.1);
        }
        
        /* Comment Input */
        .comment-input {
            width: 100%;
            min-height: 100px;
            padding: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            color: #fff;
            font-size: 14px;
            resize: vertical;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .submit-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Loop Visualization */
        .loop-section {
            margin-top: 30px;
        }
        
        .loop-visualization {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 40px 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            position: relative;
        }
        
        .loop-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            z-index: 1;
        }
        
        .loop-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            position: relative;
        }
        
        .loop-icon::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0.3;
            animation: loopPulse 3s infinite;
        }
        
        @keyframes loopPulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.5; }
        }
        
        .loop-step:nth-child(1) .loop-icon::before { animation-delay: 0s; }
        .loop-step:nth-child(2) .loop-icon::before { animation-delay: 0.5s; }
        .loop-step:nth-child(3) .loop-icon::before { animation-delay: 1s; }
        .loop-step:nth-child(4) .loop-icon::before { animation-delay: 1.5s; }
        .loop-step:nth-child(5) .loop-icon::before { animation-delay: 2s; }
        .loop-step:nth-child(6) .loop-icon::before { animation-delay: 2.5s; }
        
        .loop-icon.collect { background: rgba(102, 126, 234, 0.3); }
        .loop-icon.learn { background: rgba(118, 75, 162, 0.3); }
        .loop-icon.generate { background: rgba(0, 255, 136, 0.3); }
        .loop-icon.execute { background: rgba(255, 193, 7, 0.3); }
        .loop-icon.refine { background: rgba(255, 71, 87, 0.3); }
        .loop-icon.loop { background: rgba(102, 126, 234, 0.3); }
        
        .loop-label {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }
        
        .loop-sub {
            font-size: 11px;
            color: #888;
            text-align: center;
        }
        
        .loop-arrow {
            font-size: 24px;
            color: rgba(255,255,255,0.3);
        }
        
        /* Projection Chart */
        .projection-section {
            margin-top: 30px;
        }
        
        .chart-container {
            height: 200px;
            position: relative;
            padding: 20px 0;
        }
        
        .chart-bar {
            position: absolute;
            bottom: 40px;
            width: 60px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px 8px 0 0;
            transition: height 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .chart-bar .value {
            position: absolute;
            top: -25px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .chart-bar .month {
            position: absolute;
            bottom: -25px;
            font-size: 11px;
            color: #888;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success { border-color: rgba(0,255,136,0.5); }
        .toast.error { border-color: rgba(255,71,87,0.5); }
        
        .toast-icon {
            font-size: 20px;
        }
        
        /* New Automation Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal {
            background: #1a1a3a;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 32px;
            width: 500px;
            max-width: 90vw;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.show .modal {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(255,255,255,0.03);
            color: #fff;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .template-card {
            padding: 16px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .template-card:hover,
        .template-card.selected {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
        }
        
        .template-card .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .template-card .name {
            font-size: 13px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">âš™ï¸</div>
                <div>
                    <h1>AUTUS Automation</h1>
                    <span>ë¬´í•œ ìˆœí™˜ ë£¨í”„ Â· ìë™í™”ê°€ ìë™í™”ë¥¼ ë‚³ë‹¤</span>
                </div>
            </div>
            <div class="status-badge">
                <span class="status-dot"></span>
                <span id="loopStatus">ë£¨í”„ í™œì„±í™” Â· ì‚¬ì´í´ #127</span>
            </div>
        </header>
        
        <!-- Stats -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="label">ì´ ìë™í™”</div>
                <div class="value" id="totalAutomations">24</div>
                <div class="change positive">â†‘ 5ê°œ ì´ë²ˆ ë‹¬</div>
            </div>
            <div class="stat-card">
                <div class="label">ì´ ê°€ì¹˜</div>
                <div class="value" id="totalValue">â‚©12.8M</div>
                <div class="change positive">â†‘ 23% ì¦ê°€</div>
            </div>
            <div class="stat-card">
                <div class="label">í‰ê·  ì‹œë„ˆì§€ìœ¨</div>
                <div class="value" id="avgSynergy">8.4%</div>
                <div class="change positive">â†‘ 0.6%</div>
            </div>
            <div class="stat-card">
                <div class="label">AI ìƒì„±</div>
                <div class="value" id="aiGenerated">7</div>
                <div class="change positive">ì´ë²ˆ ì£¼ +2</div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Automation List -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ğŸ¤– í™œì„± ìë™í™”</h2>
                    <button class="action-btn" onclick="openNewModal()" style="width: auto; padding: 0 16px;">
                        + ìƒˆ ìë™í™”
                    </button>
                </div>
                
                <div class="automation-list" id="automationList">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <!-- Feedback Panel -->
            <div class="panel feedback-panel">
                <div class="panel-header">
                    <h2 class="panel-title">ğŸ’¬ í”¼ë“œë°±</h2>
                </div>
                
                <div class="feedback-form">
                    <div class="feedback-target" id="feedbackTarget">
                        <div class="label">ì„ íƒëœ ìë™í™”</div>
                        <div class="name">ìë™í™”ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                    </div>
                    
                    <div class="rating-buttons">
                        <button class="rating-btn yes" onclick="setRating(1)">
                            <span class="icon">ğŸ‘</span>
                            <span>ìœ ìš©í•´ìš”</span>
                        </button>
                        <button class="rating-btn no" onclick="setRating(0)">
                            <span class="icon">ğŸ‘</span>
                            <span>ê°œì„  í•„ìš”</span>
                        </button>
                    </div>
                    
                    <textarea class="comment-input" id="feedbackComment" placeholder="ì¶”ê°€ ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)&#10;&#10;ì˜ˆ: ì‘ë‹µ ì†ë„ê°€ ëŠë ¤ìš” / ì•Œë¦¼ì´ ë„ˆë¬´ ìì£¼ ì™€ìš”"></textarea>
                    
                    <button class="submit-btn" id="submitBtn" onclick="submitFeedback()" disabled>
                        í”¼ë“œë°± ì œì¶œ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Loop Visualization -->
        <div class="loop-section">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">â™¾ï¸ ë¬´í•œ ìˆœí™˜ ë£¨í”„</h2>
                </div>
                
                <div class="loop-visualization">
                    <div class="loop-step">
                        <div class="loop-icon collect">ğŸ“¥</div>
                        <div class="loop-label">ë°ì´í„° ìˆ˜ì§‘</div>
                        <div class="loop-sub">ì‹¤ì‹œê°„ í™œë™</div>
                    </div>
                    <div class="loop-arrow">â†’</div>
                    <div class="loop-step">
                        <div class="loop-icon learn">ğŸ§ </div>
                        <div class="loop-label">í•™ìŠµÂ·ë¶„ì„</div>
                        <div class="loop-sub">ê°€ì¹˜ ê³„ì‚°</div>
                    </div>
                    <div class="loop-arrow">â†’</div>
                    <div class="loop-step">
                        <div class="loop-icon generate">ğŸ¤–</div>
                        <div class="loop-label">ìë™í™” ìƒì„±</div>
                        <div class="loop-sub">AI Agent</div>
                    </div>
                    <div class="loop-arrow">â†’</div>
                    <div class="loop-step">
                        <div class="loop-icon execute">âš¡</div>
                        <div class="loop-label">ì‹¤í–‰Â·í”¼ë“œë°±</div>
                        <div class="loop-sub">ëˆ ì¦ê°€ ì¸¡ì •</div>
                    </div>
                    <div class="loop-arrow">â†’</div>
                    <div class="loop-step">
                        <div class="loop-icon refine">ğŸ”§</div>
                        <div class="loop-label">ë³´ì •Â·ê°œì„ </div>
                        <div class="loop-sub">ë³€ìˆ˜ ê³ ë„í™”</div>
                    </div>
                    <div class="loop-arrow">â†’</div>
                    <div class="loop-step">
                        <div class="loop-icon loop">âˆ</div>
                        <div class="loop-label">ë¬´í•œ ë°˜ë³µ</div>
                        <div class="loop-sub">ì§€ìˆ˜ìŠ¹ ê°€ì†</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Projection Chart -->
        <div class="projection-section">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ğŸ“ˆ 12ê°œì›” ìë™í™” ì˜ˆì¸¡</h2>
                </div>
                
                <div class="chart-container" id="projectionChart">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Automation Modal -->
    <div class="modal-overlay" id="newModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ†• ìƒˆ ìë™í™” ìƒì„±</h3>
                <button class="modal-close" onclick="closeNewModal()">Ã—</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">í…œí”Œë¦¿ ì„ íƒ</label>
                <div class="template-grid">
                    <div class="template-card" onclick="selectTemplate('registration')">
                        <div class="icon">ğŸ“</div>
                        <div class="name">ë“±ë¡</div>
                    </div>
                    <div class="template-card" onclick="selectTemplate('notification')">
                        <div class="icon">ğŸ””</div>
                        <div class="name">ì•Œë¦¼</div>
                    </div>
                    <div class="template-card" onclick="selectTemplate('report')">
                        <div class="icon">ğŸ“Š</div>
                        <div class="name">ë³´ê³ ì„œ</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ìë™í™” ì´ë¦„</label>
                <input type="text" class="form-input" id="newName" placeholder="ì˜ˆ: ì‹ ê·œ í•™ìƒ ë“±ë¡">
            </div>
            
            <div class="form-group">
                <label class="form-label">ì„¤ëª…</label>
                <input type="text" class="form-input" id="newDesc" placeholder="ì´ ìë™í™”ê°€ í•˜ëŠ” ì¼ì„ ê°„ë‹¨íˆ ì„¤ëª…">
            </div>
            
            <button class="submit-btn" onclick="createAutomation()">
                ìë™í™” ìƒì„±
            </button>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>
    
    <script>
        // State
        const state = {
            automations: [
                { id: 'auto_001', name: 'í•™ìƒ ë“±ë¡', type: 'registration', value: 2800000, synergy: 0.12, executions: 156, status: 'healthy', aiGenerated: false },
                { id: 'auto_002', name: 'ì›”ê°„ ë³´ê³ ì„œ', type: 'report', value: 1500000, synergy: 0.09, executions: 12, status: 'healthy', aiGenerated: false },
                { id: 'auto_003', name: 'ê²°ì œ ì•Œë¦¼', type: 'notification', value: 980000, synergy: 0.08, executions: 342, status: 'healthy', aiGenerated: false },
                { id: 'auto_004', name: 'ì¶œì„ ì²´í¬', type: 'notification', value: 450000, synergy: 0.06, executions: 89, status: 'warning', aiGenerated: true },
                { id: 'auto_005', name: 'ì‹œë„ˆì§€ ë¶„ì„', type: 'report', value: 3200000, synergy: 0.15, executions: 24, status: 'healthy', aiGenerated: true },
                { id: 'auto_006', name: 'íœ´ë©´ í•™ìƒ ì•Œë¦¼', type: 'notification', value: 120000, synergy: 0.03, executions: 8, status: 'warning', aiGenerated: true },
                { id: 'auto_007', name: 'ë¯¸ë‚©ê¸ˆ ì¶”ì ', type: 'notification', value: -50000, synergy: 0.01, executions: 4, status: 'danger', aiGenerated: true }
            ],
            selectedAutomation: null,
            selectedRating: null,
            selectedTemplate: null,
            loopCycle: 127
        };
        
        // Format currency
        function formatCurrency(value) {
            if (value >= 1000000) return `â‚©${(value / 1000000).toFixed(1)}M`;
            if (value >= 1000) return `â‚©${(value / 1000).toFixed(0)}K`;
            return `â‚©${value}`;
        }
        
        // Render automation list
        function renderAutomations() {
            const list = document.getElementById('automationList');
            list.innerHTML = state.automations.map(auto => `
                <div class="automation-item" onclick="selectAutomation('${auto.id}')">
                    <div class="automation-icon ${auto.status}">
                        ${auto.type === 'registration' ? 'ğŸ“' : auto.type === 'notification' ? 'ğŸ””' : 'ğŸ“Š'}
                    </div>
                    <div class="automation-info">
                        <h3>${auto.name} ${auto.aiGenerated ? '<span style="color:#667eea;font-size:11px;">ğŸ¤– AI</span>' : ''}</h3>
                        <span>ì‹¤í–‰ ${auto.executions}íšŒ Â· ${auto.type}</span>
                    </div>
                    <div class="automation-value">
                        <div class="amount" style="color: ${auto.value < 0 ? '#ff4757' : '#fff'}">${formatCurrency(auto.value)}</div>
                        <div class="rate">ì‹œë„ˆì§€ ${(auto.synergy * 100).toFixed(1)}%</div>
                    </div>
                    <div class="automation-synergy">
                        <div class="synergy-bar">
                            <div class="synergy-fill" style="width: ${auto.synergy * 100 * 5}%"></div>
                        </div>
                    </div>
                    <div class="automation-actions">
                        <button class="action-btn feedback" onclick="event.stopPropagation(); selectAutomation('${auto.id}')">ğŸ’¬</button>
                        <button class="action-btn delete" onclick="event.stopPropagation(); deleteAutomation('${auto.id}')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Render projection chart
        function renderProjectionChart() {
            const chart = document.getElementById('projectionChart');
            const months = ['í˜„ì¬', '3ê°œì›”', '6ê°œì›”', '9ê°œì›”', '12ê°œì›”'];
            const values = [5, 15, 40, 90, 150]; // ì˜ˆì¸¡ ìë™í™” ìˆ˜
            const maxValue = Math.max(...values);
            
            chart.innerHTML = months.map((month, i) => {
                const height = (values[i] / maxValue) * 120;
                const left = 60 + (i * (chart.offsetWidth - 120) / (months.length - 1));
                return `
                    <div class="chart-bar" style="height: ${height}px; left: ${left}px;">
                        <div class="value">${values[i]}ê°œ</div>
                        <div class="month">${month}</div>
                    </div>
                `;
            }).join('');
        }
        
        // Select automation for feedback
        function selectAutomation(id) {
            state.selectedAutomation = state.automations.find(a => a.id === id);
            document.getElementById('feedbackTarget').innerHTML = `
                <div class="label">ì„ íƒëœ ìë™í™”</div>
                <div class="name">${state.selectedAutomation.name}</div>
            `;
            updateSubmitButton();
        }
        
        // Set rating
        function setRating(rating) {
            state.selectedRating = rating;
            document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`.rating-btn.${rating === 1 ? 'yes' : 'no'}`).classList.add('selected');
            updateSubmitButton();
        }
        
        // Update submit button
        function updateSubmitButton() {
            const btn = document.getElementById('submitBtn');
            btn.disabled = !state.selectedAutomation || state.selectedRating === null;
        }
        
        // Submit feedback
        async function submitFeedback() {
            const feedback = {
                automation_id: state.selectedAutomation.id,
                rating: state.selectedRating,
                comment: document.getElementById('feedbackComment').value,
                timestamp: new Date().toISOString()
            };
            
            // Send to API
            try {
                const response = await fetch('http://localhost:8000/api/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(feedback)
                });
                
                if (response.ok) {
                    showToast('success', 'í”¼ë“œë°±ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ë³€ìˆ˜ ê³ ë„í™” ì¤‘...');
                    
                    // Update local state (simulate variable refinement)
                    const auto = state.automations.find(a => a.id === state.selectedAutomation.id);
                    if (state.selectedRating === 1) {
                        auto.synergy = Math.min(0.20, auto.synergy + 0.01);
                    } else {
                        auto.synergy = Math.max(0.01, auto.synergy - 0.02);
                    }
                    
                    renderAutomations();
                    resetFeedbackForm();
                } else {
                    throw new Error('API error');
                }
            } catch (e) {
                // Demo mode - still update
                showToast('success', 'í”¼ë“œë°±ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ë°ëª¨ ëª¨ë“œ)');
                renderAutomations();
                resetFeedbackForm();
            }
        }
        
        // Reset feedback form
        function resetFeedbackForm() {
            state.selectedAutomation = null;
            state.selectedRating = null;
            document.getElementById('feedbackTarget').innerHTML = `
                <div class="label">ì„ íƒëœ ìë™í™”</div>
                <div class="name">ìë™í™”ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
            `;
            document.getElementById('feedbackComment').value = '';
            document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
            updateSubmitButton();
        }
        
        // Delete automation
        async function deleteAutomation(id) {
            if (!confirm('ì´ ìë™í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            state.automations = state.automations.filter(a => a.id !== id);
            renderAutomations();
            showToast('success', 'ìë™í™”ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // Modal controls
        function openNewModal() {
            document.getElementById('newModal').classList.add('show');
        }
        
        function closeNewModal() {
            document.getElementById('newModal').classList.remove('show');
            state.selectedTemplate = null;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('newName').value = '';
            document.getElementById('newDesc').value = '';
        }
        
        function selectTemplate(template) {
            state.selectedTemplate = template;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }
        
        // Create automation
        function createAutomation() {
            const name = document.getElementById('newName').value;
            const desc = document.getElementById('newDesc').value;
            
            if (!name || !state.selectedTemplate) {
                showToast('error', 'ì´ë¦„ê³¼ í…œí”Œë¦¿ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const newAuto = {
                id: `auto_${Date.now()}`,
                name: name,
                type: state.selectedTemplate,
                value: 0,
                synergy: 0.08,
                executions: 0,
                status: 'healthy',
                aiGenerated: false
            };
            
            state.automations.unshift(newAuto);
            renderAutomations();
            closeNewModal();
            showToast('success', 'ìƒˆ ìë™í™”ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // Show toast
        function showToast(type, message) {
            const toast = document.getElementById('toast');
            toast.className = `toast ${type} show`;
            toast.querySelector('.toast-icon').textContent = type === 'success' ? 'âœ…' : 'âŒ';
            toast.querySelector('.toast-message').textContent = message;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Update loop cycle
        function updateLoopCycle() {
            state.loopCycle++;
            document.getElementById('loopStatus').textContent = `ë£¨í”„ í™œì„±í™” Â· ì‚¬ì´í´ #${state.loopCycle}`;
        }
        
        // Initialize
        renderAutomations();
        renderProjectionChart();
        
        // Simulate loop cycles
        setInterval(updateLoopCycle, 10000);
        
        // WebSocket for real-time updates (if available)
        try {
            const ws = new WebSocket('ws://localhost:8000/ws');
            ws.onmessage = (e) => {
                const data = JSON.parse(e.data);
                if (data.type === 'AUTOMATION_UPDATE') {
                    // Update automations
                    console.log('Received automation update:', data);
                }
            };
        } catch (e) {
            console.log('WebSocket not available, running in demo mode');
        }
    </script>
</body>
</html>
